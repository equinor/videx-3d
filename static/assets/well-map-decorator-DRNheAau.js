var le=Object.defineProperty;var ce=(n,t,r)=>t in n?le(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var _=(n,t,r)=>ce(n,typeof t!="symbol"?t+"":t,r);import{j as b}from"./jsx-runtime-CmIOflP4.js";import{r as g}from"./index-KqYmeiyw.js";import{I as de,d as ue,u as pe,W as fe,c as me,b as he}from"./WellMapCasingShoes-Z2z1IpOr.js";import{E as ge,b as ye,w as R,W as be}from"./generators-provider-decorator-C-zBAaMo.js";import{V as Z,Y as Ee,W as ve,Z as xe,X as Me,N as we,G as J,c as _e,n as Te,A as je,D as ke,I as K,y as L,e as Ce,J as Ie,a as V,C as N}from"./CameraManager-BuezL_By.js";import{L as w}from"./layers-DoaKWXpU.js";import"./index.esm-BMr5xbKZ.js";import"./index-BsNHLAmC.js";import{r as We}from"./uv-material-DyQCcDTL.js";import"./limiter-DhBcc_yH.js";import{a as Q}from"./canvas-3d-decorator-BhyssXtK.js";import{c as Le}from"./react-Mgt78q4a.js";import{g as De}from"./data-provider-decorator-BF4MaAx0.js";const B=n=>`#${n.toString(16).padStart(6,"0")}`;function S(n){return n}function q(n,...t){return Pe(n,S,S,t)}function Pe(n,t,r,s){return function i(e,o){if(o>=s.length)return r(e);const l=new de,f=s[o++];let u=-1;for(const a of e){const m=f(a,++u,e),h=l.get(m);h?h.push(a):l.set(m,[a])}for(const[a,m]of l)l.set(a,i(m,o));return t(l)}(n,0)}function Oe(n,t,r){const s=new Map(n.map(l=>[l.id,l])),i=q(n,l=>l.well),e=q(t.filter(l=>s.has(l)).map(l=>s.get(l)),l=>l.well);let o={};return i.forEach((l,f)=>{const u=e.get(f)||[],a=l.reduce((h,p)=>({...h,[p.name]:p}),{}),m=ue(a,u,r);o={...o,...m}}),o}const z=g.forwardRef(({wellbores:n,included:t=n.map(o=>o.id),selected:r,renderWellbore:s,children:i},e)=>{const o=g.useMemo(()=>n.reduce((a,m)=>({...a,[m.id]:m}),{}),[n]),l=g.useMemo(()=>Oe(n,t,r),[n,t,r]),f=g.useMemo(()=>{if(!r)return null;const a=n.find(m=>m.id===r);return a?a.well:null},[r,n]),u=g.useMemo(()=>({getHeader:m=>o[m]}),[o]);return g.useImperativeHandle(e,()=>u,[u]),l&&b.jsxs(b.Fragment,{children:[s&&t.map((a,m)=>b.jsx(g.Fragment,{children:o[a]&&l[a]&&s(o[a],l[a][0],r===a,o[a].well===f,l[a][1],m)},a)),i]})});try{z.displayName="Wells",z.__docgenInfo={description:"The `Wells` component is used to group and manage trajectories by the well property. It will \nautomatically calculate of top depths for each wellbore, depending on order and which wellbores are marked \nas being included.\n\nIt simplifies rendering of `Wellbore` components through the `renderWellbore` property, which gives usesful \ndata that can be passed to the wellbore component.",displayName:"Wells",props:{wellbores:{defaultValue:null,description:"",name:"wellbores",required:!0,type:{name:"WellboreHeader[]"}},included:{defaultValue:{value:"wellbores.map(d => d.id)"},description:"",name:"included",required:!1,type:{name:"string[] | undefined"}},selected:{defaultValue:null,description:"",name:"selected",required:!1,type:{name:"string | undefined"}},renderWellbore:{defaultValue:null,description:"",name:"renderWellbore",required:!1,type:{name:"((wellbore: WellboreHeader, startMsl: number, isSelected: boolean, isActiveWell: boolean, sequence: number, index: number) => ReactNode) | undefined"}}}}}catch{}const Ae=(n,t=1,r=1)=>[n[0]/t*2-1,-(n[1]/r)*2+1],He=(n,t=1,r=1)=>[(n[0]+1)/2*t,(1-n[1])/2*r],D=new Z,Re=[[0],[4,3,1,5,7,0,2,6,8],[12,11,7,13,17,6,8,16,18,10,2,14,22,5,1,3,9,15,21,19,23,0,4,20,24],[24,23,17,25,31,16,18,30,32,22,10,26,38,15,9,11,19,33,39,37,28,8,12,40,36,21,3,27,45,28,14,2,4,20,34,46,44,7,1,5,13,41,47,43,35,0,6,48,42]],Ke={threshold:2};class ee{constructor(t={}){_(this,"_size");_(this,"_threshold");_(this,"_renderTarget");_(this,"_pixelBuffer");_(this,"_currentId",0);const{threshold:r}={...Ke,...t};this._threshold=Math.max(Math.min(3,r),0),this._size=2*this._threshold+1;const s=new Ee(this._size,this._size);this._renderTarget=new ve(this._size,this._size,{colorSpace:xe,format:Me,type:we,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0,depthTexture:s}),this._pixelBuffer=new Uint8Array(4*this._size**2)}async pick(t,r,s,i,e,o,l=!0){const f=(this._currentId+1)%1e4;this._currentId=f;const{_renderTarget:u,_pixelBuffer:a,_threshold:m,_size:h}=this,p=r.getContext().drawingBufferWidth,c=r.getContext().drawingBufferHeight,d=He(t,p,c),E=d[0]-m,v=d[1]-m;e.forEach(y=>{const x=y.source.material;if(y.source.material=y.material,y.material=x,y.instanced){const M=y.source,W=new Float32Array(M.instanceColor.array);M.instanceColor.set(y.instanceColor),M.instanceColor.needsUpdate=!0,y.instanceColor=W}}),i.setViewOffset(p,c,E,v,h,h);const T=i.layers.mask;if(i.layers.disableAll(),i.layers.set(w.EMITTER),r.setRenderTarget(u),r.clear(),r.render(s,i),r.setRenderTarget(null),i.clearViewOffset(),i.layers.mask=T,e.forEach(y=>{if(y.source.material=y.material,y.instanced){const x=y.source;x.instanceColor.set(y.instanceColor),x.instanceColor.needsUpdate=!0,y.instanceColor=void 0}}),await r.readRenderTargetPixelsAsync(u,0,0,h,h,a),!l&&f!==this._currentId)return!1;const O=Re[m],I={match:null,position:null};for(let y=0;y<O.length;y++){const x=O[y],M=x*4,W=a[M]<<16|a[M+1]<<8|a[M+2],A=o.map.get(W);if(A){I.match=A;const re=x%h-m,ie=m-~~(x/h),H=Ae([d[0]+re,d[1]+ie],p,c),se=We(this._renderTarget.depthTexture,r,i,M).then(oe=>{const ae=oe;return D.set(H[0],H[1],ae),D.unproject(i),D.toArray()});I.position=se;break}}return I}dispose(){this._renderTarget.dispose()}}new ee({threshold:3});const Ve=300,Y=10,U=n=>{n.emitters.clear(),n.objectMap.map.clear(),n.objectMap.index=1,n.pickingMaterials.index=0,n.listeners.forEach(t=>te(t.object,n,t.object.id,0))};function te(n,t,r,s){if(n.visible&&!n.layers.isEnabled(w.NOT_EMITTER)){if(n.type==="Mesh"||n.type==="Line"||n.type==="Points"){let i=t.emitters.get(n.id);if(!i){if(t.pickingMaterials.index>=t.pickingMaterials.pool.length){const o=t.pickingMaterials.pool.length||100;for(let l=0;l<o;l++)t.pickingMaterials.pool.push(new J)}const e=t.pickingMaterials.pool[t.pickingMaterials.index];if(i={source:n,material:e,depth:s,listener:null},e.side=i.source.material.side,n.isInstancedMesh){const o=n;i.instanced=!0,i.instanceColor=new Float32Array(o.count*3),n.frustumCulled=!1,e.color.set(16777215);for(let l=0;l<o.count;l++){const f=t.objectMap.index++;t.objectMap.map.set(f,{emitter:i,index:l}),new _e(B(f)).toArray(i.instanceColor,l*3)}o.instanceColor||(o.instanceColor=new Te(new Float32Array(i.instanceColor.length).fill(1),3))}else{const o=t.objectMap.index++;e.color.set(B(o)),t.objectMap.map.set(o,{emitter:i})}t.emitters.set(n.id,i),t.pickingMaterials.index++}(!i.listener||i.depth>s)&&(i.listener=r,i.depth=s),n.layers.enable(w.EMITTER)}for(let i=0;i<n.children.length;i++)te(n.children[i],t,r,s+1)}}const P=({children:n})=>{const{gl:t,camera:r,scene:s,pointer:i}=Q(),e=g.useMemo(()=>({current:null,previous:null,buttonDown:!1,needCheckOnMove:!1,posX:-1,posY:-1,deltaTime:0,pickingHelper:new ee,emitters:new Map,listeners:new Map,objectMap:{map:new Map,index:0},pickingMaterials:{index:0,pool:[]},moveTest:!1}),[]),o=g.useMemo(()=>({register:(u,a,m)=>(e.listeners.set(u.id,{object:u,handlers:a,ref:m}),(a.enter||a.leave||a.move)&&(e.needCheckOnMove=!0),()=>{u.traverse(h=>h.layers.disable(w.EMITTER)),e.listeners.delete(u.id)})}),[e]),l=g.useCallback((u,a,m,h,p)=>{e.moveTest=!0,U(e),e.pickingHelper.pick(h,u,m,a,e.emitters,e.objectMap).then(c=>{if(c){if(e.current=c.match,e.previous&&(!e.current||e.current.emitter.listener!==e.previous.emitter.listener||e.current.emitter.listener===e.previous.emitter.listener&&e.current.index!==e.previous.index)){const d=e.listeners.get(e.previous.emitter.listener);d&&d.handlers.leave&&(d.handlers.leave({target:d.object,source:e.previous.emitter.source,ref:d.ref,instanceIndex:e.previous.index,keys:p}),u.domElement.style.cursor="")}if(e.current&&(!e.previous||e.previous.emitter.listener!==e.current.emitter.listener||e.current.emitter.listener===e.previous.emitter.listener&&e.current.index!==e.previous.index)){const d=e.listeners.get(e.current.emitter.listener);d&&d.handlers.enter&&(d.handlers.enter({target:d.object,source:e.current.emitter.source,ref:d.ref,instanceIndex:e.current.index,keys:p}),u.domElement.style.cursor=d.handlers.click?"pointer":"")}if(e.current&&(e.previous===null||e.previous.emitter.listener===e.current.emitter.listener&&(!e.previous.index||e.previous.index===e.current.index))){const d=e.listeners.get(e.current.emitter.listener);if(d&&d.handlers.move){const E=e.current.emitter.source,v=e.current.index;c.position&&c.position.then(T=>{d.handlers.move({target:d.object,source:E,ref:d.ref,instanceIndex:v,position:T,keys:p})})}}e.previous=e.current,e.moveTest=!1}})},[e]),f=g.useCallback((u,a,m,h,p)=>{U(e),e.pickingHelper.pick(h,u,m,a,e.emitters,e.objectMap,!0).then(c=>{if(c&&c.match){const d=c.match,E=e.listeners.get(d.emitter.listener);E&&E.handlers.click&&c.position&&c.position.then(v=>{E.handlers.click({position:v,target:E.object,source:d.emitter.source,ref:E.ref,instanceIndex:d.index,keys:p})})}})},[e]);return g.useEffect(()=>{function u(c){if(!e.moveTest&&e.needCheckOnMove&&!e.buttonDown){const d={ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,altKey:c.altKey};l(t,r,s,i.toArray(),d)}}function a(c){c.isPrimary&&(e.buttonDown=!0,e.posX=c.pageX,e.posY=c.pageY,e.deltaTime=performance.now())}function m(c){if(c.isPrimary){const d=performance.now();if(e.buttonDown&&d-e.deltaTime<Ve&&Math.abs(c.pageX-e.posX)<Y&&Math.abs(c.pageY-e.posY)<Y){const E={ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,altKey:c.altKey};f(t,r,s,i.toArray(),E)}e.buttonDown=!1}}function h(){e.current=null,e.previous=null}function p(c){const d={ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,altKey:c.altKey};setTimeout(()=>{e.needCheckOnMove&&!e.buttonDown&&!e.moveTest&&l(t,r,s,i.toArray(),d)},250)}return t.domElement.addEventListener("pointermove",u,{passive:!0,capture:!0}),t.domElement.addEventListener("pointerdown",a,{passive:!0,capture:!0}),t.domElement.addEventListener("pointerup",m,{passive:!0,capture:!0}),t.domElement.addEventListener("pointercancel",h,{passive:!0,capture:!0}),t.domElement.addEventListener("pointerenter",u,{passive:!0,capture:!0}),t.domElement.addEventListener("pointerleave",u,{passive:!0,capture:!0}),t.domElement.addEventListener("wheel",p,{passive:!0,capture:!0}),()=>{t.domElement.removeEventListener("pointermove",u),t.domElement.removeEventListener("pointerdown",a),t.domElement.removeEventListener("pointerup",m),t.domElement.removeEventListener("pointercancel",h),t.domElement.removeEventListener("pointerenter",u),t.domElement.removeEventListener("pointerleave",u),t.domElement.removeEventListener("wheel",p)}},[t,i,r,s,l,f,e]),g.useEffect(()=>()=>{e.current=null,e.previous=null,e.listeners.clear(),e.pickingHelper.dispose(),e.pickingMaterials.pool.splice(0,e.pickingMaterials.pool.length)},[e]),b.jsx(ge.Provider,{value:o,children:n})};try{P.displayName="EventEmitter",P.__docgenInfo={description:`The EventEmitter provider component allow child components to register as an event emitter.
Event emitter objects are rendered offscreen every frame and tested for proximity to the pointer location (i.e. mouse cursor).

Each object is asigned an unique color, using an override material, and a small area
is rendered around the pointer. The rendered framebuffer is returned from the GPU and 
processed on the CPU side to detect pointer events, such as pointer click, pointer enter,
pointer exit and pointer move.

This allows for a more performant interaction model (than using raycasting) when there are 
a large number of objects that needs to be tested.     

To add a component as an event emitter, use the \`useEventEmitter\` hook.`,displayName:"EventEmitter",props:{}}}catch{}const X=n=>b.jsx(P,{children:b.jsx(n,{})});try{X.displayName="EventEmitterDecorator",X.__docgenInfo={description:"",displayName:"EventEmitterDecorator",props:{}}}catch{}const C=(n,t)=>t?`${n.id}_${t}`:`${n.id}`;function Ne(n,t,r){n.traverseVisible(s=>{s.layers.isEnabled(w.NOT_EMITTER)||(s.type==="Mesh"||s.type==="Line")&&(t[C(s,r)]={object:s,instanceIndex:r})})}function Be(n,t,r){n.traverse(s=>{(s.type==="Mesh"||s.type==="Line")&&delete t[C(s,r)]})}const ne=Le(n=>({highlighted:[],set:n})),st=()=>{const n=ne(t=>t.set);return{highlight:(t,r)=>n(s=>{const i=s.highlighted.reduce((e,o)=>({...e,[C(o.object,o.instanceIndex)]:o}),{});return Ne(t,i,r),{highlighted:Object.values(i).filter(e=>e.object.layers.isEnabled(w.EMITTER)&&e.object.visible)}}),removeHighlight:(t,r)=>n(s=>{const i=s.highlighted.reduce((e,o)=>({...e,[C(o.object,o.instanceIndex)]:o}),{});return Be(t,i,r),{highlighted:Object.values(i).filter(e=>e.object.layers.isEnabled(w.EMITTER)&&e.object.visible)}}),removeAll:()=>{n({highlighted:[]})}}},j=new J({color:4210752,depthTest:!0,depthWrite:!1,transparent:!0,opacity:1,blending:je,side:ke}),F=new Ie,G=()=>{const{highlighted:n}=ne(),t=g.useMemo(()=>n.map(r=>{let s;const i=r.object.geometry;if(r.object instanceof K){const e=r.object;if(r.instanceIndex)s=new L(i,j),r.object.getWorldPosition(s.position),e.getMatrixAt(r.instanceIndex,F),s.applyMatrix4(F);else{const o=new K(i,j,e.count);r.object.getWorldPosition(o.position),o.instanceMatrix=e.instanceMatrix,s=o}}else r.object instanceof L?(s=new L(i,j),r.object.getWorldPosition(s.position)):(s=new Ce(i,j),r.object.getWorldPosition(s.position));return s.visible=r.object.visible,s}),[n]);return b.jsx("group",{renderOrder:999,children:t.map(r=>b.jsx("primitive",{object:r},r.uuid))})};try{G.displayName="Highlighter",G.__docgenInfo={description:'Adds highlighting to rendered objects by rendering a "ghost" object on top it.',displayName:"Highlighter",props:{}}}catch{}const k=new Z,$=({radius:n=3,opacity:t=.1,color:r,fixedX:s,fixedY:i,fixedZ:e,renderOrder:o=1e3})=>{const{controls:l}=Q(),f=g.useRef(null);return g.useEffect(()=>{function u(){const a=l;a&&f.current?(a.getTarget(k),f.current.position.set(s||k.x,i||k.y,e||k.z),f.current.visible=!0):f.current&&(f.current.visible=!1)}return l&&l.addEventListener("update",u),()=>{l&&l.removeEventListener("update",u)}},[l,s,i,e]),b.jsx("group",{ref:f,visible:!1,renderOrder:o,children:b.jsxs("mesh",{children:[b.jsx("sphereGeometry",{args:[n]}),b.jsx("meshBasicMaterial",{color:r,transparent:!0,opacity:t,depthTest:!1,depthWrite:!1})]})})};try{$.displayName="CameraTargetMarker",$.__docgenInfo={description:"A simple component for indicating the current camera target.",displayName:"CameraTargetMarker",props:{radius:{defaultValue:{value:"3"},description:"",name:"radius",required:!1,type:{name:"number | undefined"}},opacity:{defaultValue:{value:"0.1"},description:"",name:"opacity",required:!1,type:{name:"number | undefined"}},color:{defaultValue:null,description:"",name:"color",required:!1,type:{name:"string | number | Color | undefined"}},fixedX:{defaultValue:null,description:"",name:"fixedX",required:!1,type:{name:"number | undefined"}},fixedY:{defaultValue:null,description:"",name:"fixedY",required:!1,type:{name:"number | undefined"}},fixedZ:{defaultValue:null,description:"",name:"fixedZ",required:!1,type:{name:"number | undefined"}},renderOrder:{defaultValue:{value:"1000"},description:"",name:"renderOrder",required:!1,type:{name:"number | undefined"}}}}}catch{}const Se={display:"flex",flexDirection:"row",position:"absolute",height:"auto",bottom:0,top:0,left:0,right:0},qe=new ye,ze=({colorScale:n})=>{const t=g.useRef([0,0,0]),[r,s]=g.useState(),[i,e]=g.useState(),[o,l]=g.useState(null),f=g.useRef(null),u=pe(),a=g.useCallback((h,p=!1)=>{if(s(h),f.current){const c=f.current.getPointAtDepth(h,!0);c[0]+=t.current[0],c[1]+=t.current[1],c[2]+=t.current[2],p?dispatchEvent(new V({point:c})):dispatchEvent(new N(c))}},[]);g.useEffect(()=>{async function h(p){var c;if(u){if(p.detail.id!==i){t.current=((c=qe.getInfo(p.detail.id))==null?void 0:c.position)||[0,0,0],e(p.detail.id);const d=await u.get("position-logs",p.detail.id);if(d){const E=De(p.detail.id,d);E?f.current=E:f.current=null;const v=await u.get("wellbore-headers",p.detail.id);v&&v.well!==o&&l(v.well)}}if(f.current!==null)if(p.detail.position){const d=p.detail.position,E=[d[0]-t.current[0],d[1]-t.current[1],d[2]-t.current[2]],v=f.current.curve.nearest(E);if(v){const T=[v.point[0]+t.current[0],v.point[1]+t.current[1],v.point[2]+t.current[2]];s(f.current.measuredTop+v.position*f.current.measuredLength),p.detail.flyTo?dispatchEvent(new V({point:T})):dispatchEvent(new N(p.detail.position))}}else p.detail.depth?a(p.detail.depth,p.detail.flyTo):a(f.current.measuredTop)}}return addEventListener(R,h),()=>{removeEventListener(R,h)}},[u,i,o,a]);const m=g.useCallback((h,p)=>{f.current&&dispatchEvent(new be({id:h,depth:p,flyTo:!0}))},[]);return b.jsx("div",{style:{padding:"0.5em 0 0.5em 2px",background:"#222222a0",zIndex:10,pointerEvents:"all"},children:o&&b.jsxs(fe,{colors:n?h=>n(h.name.replace(h.well,"")||"Main"):void 0,depth:r,onDepthChanged:a,wellIdentifier:o,selected:i,onSelect:m,children:[b.jsx(me,{}),b.jsx(he,{})]})})},ot=(n,{parameters:t})=>b.jsxs("div",{style:Se,children:[b.jsx(ze,{colorScale:t.colorScale}),b.jsx(n,{})]});export{$ as C,X as E,G as H,ot as W,z as a,st as u};
