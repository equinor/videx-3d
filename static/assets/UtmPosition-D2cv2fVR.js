var A=Object.defineProperty;var M=(n,e,t)=>e in n?A(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var p=(n,e,t)=>M(n,typeof e!="symbol"?e+"":e,t);import{j as h}from"./jsx-runtime-CmIOflP4.js";import{r as m}from"./index-KqYmeiyw.js";import{p as q}from"./uv-material-Cw8kPkQB.js";import{V as f}from"./CameraManager-BTlj_2qD.js";const z="+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";class C{constructor(e,t,s="lnglat"){p(this,"utmDef");p(this,"originWgs84");p(this,"originUtm");p(this,"_projection");this.utmDef=e,this._projection=q(z,e),s==="lnglat"?(this.originWgs84=t,this.originUtm=this.wgs84ToUtm(t)):(this.originWgs84=this.utmToWgs84(t),this.originUtm=t)}utmToWgs84(e){return this._projection.inverse(e)}wgs84ToUtm(e){return this._projection.forward(e)}utmToWorld(e,t,s){return{x:e-this.originUtm[0],y:s,z:this.originUtm[1]-t}}worldToUtm(e,t,s){return{easting:e+this.originUtm[0],altitude:t,northing:this.originUtm[1]-s}}wgs84ToWorld(e,t,s=0){const c=this.wgs84ToUtm([e,t]);return this.utmToWorld(c[0],c[1],s)}worldToWgs84(e,t,s){const c=this.worldToUtm(e,t,s),d=this.utmToWgs84([c.easting,c.northing]);return{lng:d[0],lat:d[1],alt:t}}}function D(n){const[,e,t]=new RegExp(/^([0-9]{2})([N|S]?)$/).exec(n)||[];return`+proj=utm +zone=${e}${t==="S"?" +south":""} +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +units=m +no_defs`}const W=m.createContext(null),U=m.forwardRef(({utmZone:n,origin:e,originUnits:t="utm",offset:s=[0,0,0],children:c},d)=>{const l=m.useRef(null),i=m.useMemo(()=>{const g=D(n.toUpperCase());return new C(g,e,t)},[n,e,t]);m.useImperativeHandle(d,()=>i,[i]);const y=m.useMemo(()=>{const g=(o,a,u=0)=>{const r=i.utmToWorld(o,a,u);return[r.x,r.y,r.z]},_=(o,a,u=0)=>{const r=i.wgs84ToWorld(o,a,u);return[r.x,r.y,r.z]},x=(o,a,u)=>i.worldToUtm(o,a,u),j=(o,a,u)=>{if(!l.current)throw Error("Missing reference!");const r=new f;return l.current.getWorldPosition(r),i.worldToUtm(-r.x+o,-r.y+a,-r.z+u)},b=(o,a,u)=>i.worldToWgs84(o,a,u),P=(o,a,u)=>{if(!l.current)throw Error("Missing reference!");const r=new f;return l.current.getWorldPosition(r),i.worldToWgs84(-r.x+o,-r.y+a,-r.z+u)},w=()=>{if(!l.current)throw Error("Missing reference!");const o=new f;return l.current.getWorldPosition(o),[o.x,o.y,o.z]},V=()=>{const o=w();return[o[0]-i.originUtm[0],-o[1],o[2]+i.originUtm[1]]};return{originUtm:i.originUtm,originWgs84:i.originWgs84,utmToArea:g,wgs84ToArea:_,areaToUtm:x,worldToUtm:j,areaToWgs84:b,worldToWgs84:P,getWorldPosition:w,getUtmOrigin:V}},[i]);return h.jsx("group",{ref:l,position:s,children:h.jsx(W.Provider,{value:y,children:c})})});try{U.displayName="UtmArea",U.__docgenInfo={description:`A container component that maps a UTM reference point to a 3d world space origin. This can be used by sub components to 
position themselves by using UTM or Wgs84 coordinates as well as converting between these and 3d space coordinates.`,displayName:"UtmArea",props:{utmZone:{defaultValue:null,description:"",name:"utmZone",required:!0,type:{name:"string"}},origin:{defaultValue:null,description:"",name:"origin",required:!0,type:{name:"[number, number]"}},originUnits:{defaultValue:{value:"utm"},description:"",name:"originUnits",required:!1,type:{name:'"utm" | "lnglat" | undefined'}},offset:{defaultValue:{value:"[0, 0, 0]"},description:"",name:"offset",required:!1,type:{name:"Vec3 | undefined"}},utmProjectionDef:{defaultValue:null,description:"",name:"utmProjectionDef",required:!1,type:{name:"string | undefined"}}}}}catch{}const T=({easting:n,northing:e,altitude:t=0,children:s})=>{const c=m.useContext(W),d=m.useMemo(()=>c.utmToArea(n,e,t),[n,e,t,c]);return h.jsx("group",{position:d,children:s})};try{T.displayName="UtmPosition",T.__docgenInfo={description:"Container component which allows sub components positioned relative to a UTM coordinate. Used with the `UtmArea`\ncomponent.",displayName:"UtmPosition",props:{easting:{defaultValue:null,description:"",name:"easting",required:!0,type:{name:"number"}},northing:{defaultValue:null,description:"",name:"northing",required:!0,type:{name:"number"}},altitude:{defaultValue:{value:"0"},description:"",name:"altitude",required:!1,type:{name:"number | undefined"}}}}}catch{}export{U,T as a,W as b,D as g,z as w};
